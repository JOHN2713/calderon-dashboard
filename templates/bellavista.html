<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard H√≠drico - Puembo a Bellavista</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f4f4f4;
        }

        h1 {
            color: #0a4d8c;
        }

        .kpi {
            display: inline-block;
            width: 30%;
            background: #fff;
            padding: 20px;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .flow-container,
        .cards-container,
        .charts-combined,
        .tables-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .flow-title {
            color: #0a4d8c;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .chart-buttons button {
            margin: 5px;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            background-color: #0a4d8c;
            color: white;
            cursor: pointer;
        }

        canvas {
            max-height: 300px;
        }

        .charts-combined {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .chart-container {
            flex: 1 1 45%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #0a4d8c;
            color: white;
        }
    </style>
</head>

<body>
    <h1 class="text-xl font-bold text-blue-800 mb-4">Dashboard del Flujo de Agua - Puembo a Bellavista</h1>
    <div class="text-center my-6">
        <a href="{{ url_for('flujoagua') }}"
            class="inline-block bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded shadow transition">
            üíß Flujo de Agua - Calder√≥n
        </a>
    </div>
    <div class="kpi">
        <h2>Caudal M√°ximo Observado</h2>
        <p><strong>934 L/s</strong></p>
    </div>
    <div class="kpi">
        <h2>Poblaci√≥n Estimada</h2>
        <p><strong>250,000 Habitantes</strong></p>
    </div>
    <div class="kpi">
        <h2>Demanda Total Estimada</h2>
        <p><strong id="demanda-estimada">17,500,000 L/d√≠a</strong></p>
    </div>

    <div class="dashboard-grid">
        <div class="charts-combined">
            <div class="chart-container">
                <h3>Demanda vs. Caudal Disponible por Mes</h3>
                <div class="chart-buttons">
                    <button onclick="updateChart('media')">Media</button>
                    <button onclick="updateChart('max')">M√°ximo</button>
                    <button onclick="updateChart('min')">M√≠nimo</button>
                </div>
                <canvas id="lineChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Excedente o D√©ficit por Mes</h3>
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div class="tables-container">
            <h3>Tabla Comparativa: Caudal vs. Demanda</h3>
            <table>
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Caudal (L/s)</th>
                        <th>Demanda (L/d√≠a)</th>
                        <th>Excedente/D√©ficit (L/d√≠a)</th>
                    </tr>
                </thead>
                <tbody id="tabla-datos"></tbody>
            </table>
        </div>
    </div>

    <script>
        const meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

        // Caudales promedio por mes (Puembo‚ÄìBellavista)
        const caudalMedia = [683.1, 710.6, 707.5, 698.8, 688.3, 676.4, 691.7, 717.9, 734.4, 745.5, 752.0, 756.6];
        const caudalMax = [839.7, 862.1, 870.2, 861.2, 849.3, 841.0, 855.6, 882.5, 903.4, 915.2, 923.1, 934.0];
        const caudalMin = [540.2, 561.0, 552.3, 544.2, 530.1, 520.4, 535.9, 558.6, 573.3, 580.4, 590.8, 602.1];

        const demanda = Array(12).fill(44500000); // Demanda diaria total (250,000 personas * 70 L)

        let estado = caudalMedia.map((c, i) => Math.round(c * 86400 - demanda[i]));

        const lineChart = new Chart(document.getElementById("lineChart"), {
            type: "line",
            data: {
                labels: meses,
                datasets: [{
                    label: "Caudal (Media) (L/s)",
                    data: caudalMedia,
                    borderColor: "#1f77b4",
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        const barChart = new Chart(document.getElementById("barChart"), {
            type: "bar",
            data: {
                labels: meses,
                datasets: [{
                    label: "Excedente o D√©ficit (L/d√≠a)",
                    data: estado,
                    backgroundColor: estado.map(x => x >= 0 ? "#2ca02c" : "#ff7f0e")
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        function updateChart(tipo) {
            const datasets = { media: caudalMedia, min: caudalMin, max: caudalMax };
            const selected = datasets[tipo];
            lineChart.data.datasets[0].data = selected;
            lineChart.data.datasets[0].label = `Caudal (${tipo}) (L/s)`;
            lineChart.update();

            estado = selected.map((c, i) => Math.round(c * 86400 - demanda[i]));
            barChart.data.datasets[0].data = estado;
            barChart.data.datasets[0].backgroundColor = estado.map(x => x >= 0 ? "#2ca02c" : "#ff7f0e");
            barChart.update();

            renderTable(selected);
        }

        function renderTable(caudales) {
            const tabla = document.getElementById("tabla-datos");
            tabla.innerHTML = "";
            caudales.forEach((c, i) => {
                const excedente = Math.round(c * 86400 - demanda[i]);
                tabla.innerHTML += `
      <tr>
        <td>${meses[i]}</td>
        <td>${c.toFixed(1)}</td>
        <td>${demanda[i].toLocaleString()}</td>
        <td>${excedente.toLocaleString()}</td>
      </tr>
    `;
            });
        }

        renderTable(caudalMedia);
    </script>
</body>

</html>