<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard H√≠drico - Calder√≥n</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f4f4f4;
        }

        h1 {
            color: #0a4d8c;
        }

        .kpi {
            display: inline-block;
            width: 25%;
            background: #fff;
            padding: 20px;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .flow-container,
        .cards-container,
        .charts-combined,
        .tables-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .flow-title {
            color: #0a4d8c;
            font-weight: bold;
            margin-bottom: 10px;
        }

        svg text {
            font-size: 13px;
            fill: #000;
        }

        .chart-buttons button {
            margin: 5px;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            background-color: #0a4d8c;
            color: white;
            cursor: pointer;
        }

        .reason-card {
            margin: 10px 0;
            padding: 10px;
            background: #eaf3ff;
            border-left: 6px solid #0a4d8c;
            border-radius: 4px;
        }

        .reason-card strong {
            color: #0a4d8c;
        }

        canvas {
            max-height: 300px;
        }

        .charts-combined {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .chart-container {
            flex: 1 1 45%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #0a4d8c;
            color: white;
        }
    </style>
</head>

<body>
    <h1 class="text-xl font-bold text-blue-800 mb-4"><strong>Dashboard del Flujo de Agua - Calder√≥n</strong></h1>
    <div class="text-center my-6">
        <a href="{{ url_for('bellavista') }}"
            class="inline-block bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded shadow transition">
            üíß Flujo de Agua - Bellavista
        </a>
    </div>
    <div class="kpi">
        <h2>Caudal M√°ximo Potencial</h2>
        <p><strong>1,300 L/s</strong></p>
    </div>
    <div class="kpi">
        <h2>Poblaci√≥n Estimada Destinada</h2>
        <p><strong>180,000 Habitantes</strong></p>
    </div>
    <div class="kpi">
        <h2>Demanda Estimada</h2>
        <p><strong id="demanda-estimada">35,000,000 L/d√≠a</strong></p>
    </div>

    <div class="dashboard-grid">
        <div class="flex flex-col md:flex-row items-center justify-between mt-10 p-6 bg-white rounded-lg shadow">
            <!-- Texto a la izquierda -->
            <div class="md:w-1/2 pr-4">
                <h2 class="text-2xl font-bold text-blue-800 mb-4">¬øPor qu√© cambia la demanda de agua?</h2>
                <p class="text-gray-700 leading-relaxed">
                    <strong>üèñ Temporada alta (Julio‚ÄìAgosto‚ÄìSeptiembre): </strong>Mayor consumo por vacaciones
                    escolares, migraci√≥n estacional y turismo.<br>
                    <strong>üìâ Reducci√≥n en meses frescos (Abril‚ÄìJunio): </strong>Menor uso de agua por clima fr√≠o y
                    baja ocupaci√≥n residencial.<br>
                    <strong>üìà Crecimiento urbano (Octubre‚ÄìDiciembre): </strong>Nuevas construcciones y expansi√≥n
                    generan mayor demanda.<br>
                </p>
            </div>
            <!-- Imagen a la derecha -->
            <div class="md:w-1/2 flex justify-center mt-6 md:mt-0">
                <img src="{{ url_for('static', filename='carihuayco.jpeg') }}" alt="Demanda de agua"
                    class="w-100 h-auto rounded-lg shadow-md">
            </div>
        </div>

        <div class="flow-container">
            <div class="flow-title">Flujo de Distribuci√≥n del Agua - Sistema Papallacta ‚Üí Calder√≥n</div>
            <svg width="100%" height="320">
                <rect id="papallacta" x="20" y="130" width="140" height="50" fill="#d0e1f9" />
                <text x="40" y="160">üåä Papallacta</text>

                <rect id="embalse" x="180" y="130" width="140" height="50" fill="#aed6f1" />
                <text x="200" y="160">Embalse</text>

                <rect id="paluguillo" x="340" y="60" width="140" height="50" fill="#85c1e9" />
                <text x="355" y="90">Paluguillo</text>

                <rect id="puembo" x="340" y="200" width="170" height="60" fill="#85c1e9" />
                <text x="350" y="220">Puembo</text>
                <text x="350" y="235">‚Ü≥ 1,300 L/s a Calder√≥n</text>
                <text x="350" y="250">‚Ü≥ 3,000 L/s a Quito</text>

                <rect id="planta" x="540" y="80" width="140" height="50" fill="#58d68d" />
                <text x="550" y="110">Planta Calder√≥n</text>

                <rect id="distribucion" x="720" y="80" width="140" height="50" fill="#2ecc71" />
                <text x="735" y="110">Distribuci√≥n</text>

                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto"
                        markerUnits="strokeWidth">
                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                    </marker>
                </defs>

                <line x1="160" y1="155" x2="180" y2="155" stroke="black" marker-end="url(#arrow)" />
                <text x="160" y="145">2,200 L/s</text>

                <line x1="320" y1="155" x2="340" y2="85" stroke="black" marker-end="url(#arrow)" />
                <text x="300" y="70">4,300 L/s</text>

                <line x1="320" y1="155" x2="340" y2="230" stroke="black" marker-end="url(#arrow)" />

                <line x1="510" y1="105" x2="540" y2="105" stroke="black" marker-end="url(#arrow)" />
                <text x="510" y="95">1,300 L/s</text>

                <line x1="680" y1="105" x2="720" y2="105" stroke="black" marker-end="url(#arrow)" />
                <text x="680" y="95">650 L/s</text>
            </svg>
        </div>

        <div class="charts-combined">
            <div class="chart-container">
                <h3>Demanda vs. Caudal Disponible por Mes</h3>
                <div class="chart-buttons">
                    <button onclick="updateChart('media')">Media</button>
                    <button onclick="updateChart('max')">M√°ximo</button>
                    <button onclick="updateChart('min')">M√≠nimo</button>
                </div>
                <canvas id="lineChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Estado del Abastecimiento por Mes</h3>
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div class="tables-container">
            <h3><strong>Tabla Comparativa: Caudal vs. Demanda</strong></h3>
            <table>
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Caudal Medio (L/s)</th>
                        <th>Demanda Estimada (L/d√≠a)</th>
                        <th>Excedente/D√©ficit (L/d√≠a)</th>
                    </tr>
                </thead>
                <tbody id="tabla-datos"></tbody>
            </table>
        </div>
    </div>

    <script>
        const meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const caudalMax = Array(12).fill(1300);
        const caudalMin = [28.8, 30.1, 30.6, 31.0, 31.8, 40.6, 41.5, 44.8, 49.6, 64.1, 65.2, 96.8];
        const caudalMedia = [650, 680, 700, 720, 740, 750, 780, 800, 820, 830, 850, 870];
        const demanda = [12000000, 12000000, 12000000, 11000000, 11000000, 11000000, 14000000, 14500000, 14200000, 13500000, 13000000, 12500000];
        let estado = caudalMedia.map((d, i) => d * 86400 - demanda[i]);

        const lineChart = new Chart(document.getElementById("lineChart"), {
            type: "line",
            data: {
                labels: meses,
                datasets: [{ label: "Caudal (Media) (L/s)", data: caudalMedia, borderColor: "#1f77b4", fill: false }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });

        const barChart = new Chart(document.getElementById("barChart"), {
            type: "bar",
            data: {
                labels: meses,
                datasets: [{ label: "Excedente o D√©ficit (L/d√≠a)", data: estado, backgroundColor: estado.map(x => x >= 0 ? "#2ca02c" : "#ff7f0e") }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });

        function updateChart(tipo) {
            const datasets = { media: caudalMedia, min: caudalMin, max: caudalMax };
            const selected = datasets[tipo];
            lineChart.data.datasets[0].data = selected;
            lineChart.data.datasets[0].label = `Caudal (${tipo}) (L/s)`;
            lineChart.update();
            estado = selected.map((d, i) => d * 86400 - demanda[i]);
            barChart.data.datasets[0].data = estado;
            barChart.data.datasets[0].backgroundColor = estado.map(x => x >= 0 ? "#2ca02c" : "#ff7f0e");
            barChart.update();
            renderTable(selected);
        }

        function renderTable(caudales) {
            const tabla = document.getElementById("tabla-datos");
            tabla.innerHTML = "";
            caudales.forEach((c, i) => {
                const excedente = Math.round(c * 86400 - demanda[i]);
                tabla.innerHTML += `<tr><td>${meses[i]}</td><td>${c}</td><td>${demanda[i].toLocaleString()}</td><td>${excedente.toLocaleString()}</td></tr>`;
            });
        }

        renderTable(caudalMedia);
    </script>
</body>

</html>